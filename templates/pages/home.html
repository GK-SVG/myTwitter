{%extends 'base.html'%}
{% block content %}
<div id='tweets'>
    Loading...
</div>
{% endblock content %}
{% block js %}
<script>

function handleDidLike (tweet_id, currentCount) {
    console.log(tweet_id, currentCount)
    return 
}


function LikeBtn(tweet) {
    return `<button class='btn btn-primary btn-sm' onclick=${handleDidLike( 
    tweet.id,tweet.likes)}>${tweet.likes}Likes</button>`
}


function formatTweetElement(tweet) {
    var formattedTweet = `<div class='col-12 col-md-10 mx-auto border rounded py-3 mb-4 tweet' id='tweet-${tweet.id}'><p>${tweet.content} 
        </p><div class='btn-group'>${LikeBtn(tweet)}</div></div>`
    return formattedTweet
}

const tweetsElement = document.getElementById("tweets") // get an html element
const xhr = new XMLHttpRequest()
const method = 'GET'
const url = "/tweets"
const responseType = "json"
xhr.responseType = responseType
xhr.open(method, url)
xhr.onload = function() {
    const serverResponse = xhr.response
    const listedItems = serverResponse.response // array
    var finalTweetStr = ""
    var i;
    for (i=0;i<listedItems.length; i++) {
        var currentItem=formatTweetElement(listedItems[i])
        finalTweetStr += currentItem
    }
    tweetsElement.innerHTML = finalTweetStr
    console.log(listedItems);
}
xhr.send()
</script>
{% endblock js %}